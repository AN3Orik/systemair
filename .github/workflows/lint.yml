name: "Lint & Fix"

on:
  push:
    branches:
      - "**"
  pull_request:
    branches:
      - "main"

permissions:
  contents: write

jobs:
  ruff:
    name: "Ruff"
    runs-on: "ubuntu-latest"
    steps:
        - name: "Checkout the repository"
          uses: "actions/checkout@v6"
          with:
            ref: ${{ github.head_ref }}

        - name: "Set up Python"
          uses: actions/setup-python@v6
          with:
            python-version: "3.13"
            cache: "pip"

        - name: "Install requirements"
          run: python3 -m pip install -r requirements.txt

        # On Push: Fix and Format
        - name: "Ruff Check & Fix"
          if: github.event_name == 'push'
          run: |
            python3 -m ruff check . --fix
            python3 -m ruff format .

        # On PR: Check only (fail if errors found)
        - name: "Ruff Check (Read-only)"
          if: github.event_name == 'pull_request'
          run: |
            python3 -m ruff check .
            python3 -m ruff format . --check

        # Commit changes only on Push
        - name: "Commit changes"
          if: github.event_name == 'push'
          uses: stefanzweifel/git-auto-commit-action@v7
          with:
            commit_message: "style: auto-fix linting issues with Ruff"
            branch: ${{ github.head_ref }}
